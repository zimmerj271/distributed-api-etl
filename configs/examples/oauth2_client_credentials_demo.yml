# ============================================================
# PIPELINE CONFIGURATION - OAuth2 Client Credentials with Keycloak
# ============================================================
# This example demonstrates OAuth2 Client Credentials authentication
# using the local Keycloak instance. Start Keycloak with:
#   make up-keycloak
#
# Keycloak Admin Console: http://localhost:8180
#   Username: admin
#   Password: admin
#
# Mock API endpoints: http://localhost:8200
#   - /api/oauth2/data - requires Bearer token from Keycloak
#
# Client credentials configured in realm:
#   Client ID: etl-client
#   Client Secret: etl-client-secret
#
# Note: Client credentials flow authenticates the application itself,
# not on behalf of a user. Use this for service-to-service communication.

# -------------------------
# Endpoint Configuration
# -------------------------
endpoint:
  name: oauth2_client_credentials_demo
  base_url: "http://mock-api:8000"
  url_path: "http://mock-api:8000/api/oauth2/data"
  method: GET
  vendor: mock-api
  headers:
    Accept: "application/json"

# -------------------------
# Transport Configuration
# -------------------------
transport:
  base_timeout: 30
  warmup_timeout: 10
  tcp_connection:
    limit: 2

# -------------------------
# Authentication (OAuth2 Client Credentials)
# -------------------------
auth:
  type: oauth2_client_credentials
  token_url: "http://keycloak:8080/realms/distributed-etl/protocol/openid-connect/token"
  client_id: "etl-client"
  client_secret: "etl-client-secret"
  refresh_margin: 60

# -------------------------
# Middleware Pipeline
# -------------------------
middleware:
  - type: logging
  - type: timing
  - type: json_body
  - type: retry
    max_attempts: 5
    retry_status_codes: [429, 500, 502, 503]
    base_delay: 0.2
    max_delay: 2.0

# -------------------------
# ETL Tables
# -------------------------
tables:
  sink:
    name: oauth2_client_credentials_demo_response
    namespace: demo
    mode: overwrite

  column_mappings: []

# -------------------------
# Execution
# -------------------------
execution:
  num_partitions: 5
  batch_size: 100
